# AttractionsTelegramBot (КДЗ_3_3 | Варинат 3)

## Преамбула

Считаю, что было бы некорректным делать огромные блоки текста, обосновывающие те либо иные пути решения проблемы, поэтому краткое описание будет в этом README файле.

## Запуск проекта

> **Requirements**: Docker; Docker Compose

Для запуска проекта на локальной машине следует развернуть контейнеры с основным контейнером и базой данных. Сделать это можно одной командой, находясь в корневой папке, то есть, в которой находится файл [docker-compose.yaml](/docker-compose.yaml):

```console
docker compose up --build -d
```

После этого можно начинать пользоваться приложением.

### Nota Bene

> Так же необходимо ввести **BOT_TOKEN** в качестве константы в файле [Program.cs](TelegramBot/Program.cs)

## Архитектура решения

Для разделения бизнес-логики от хранения данных и возможности работы с каджым элементом по отдельности, а также для удобной развертки  приложения и управления им на сервере было решено использовать паттерн контейнеризации при помощи Docker и Docker Compose.

![Architecture](/readme-assert/architecture.png)

### Данные

Вся работа с данными и фреймворком Базы данных происходит в библиотеке классов `DataManager`. Класс [`DatabaseContext`](/DataManager/DatabaseContext.cs) отвечает за создание базы данных, сохранение изменений и т.д. (то есть все взаимодействие с БД происзодит через экземпляры этого класса). Можно ознакомиться с классами данных (таблицы в БД).

![Data Class Diagram](/readme-assert/DataClassDiagram.png)

### Работа с Телеграм-ботом

В классе [`Program`](/TelegramBot/Program.cs) инициалзируется экземпляр бота [`BotManager`](/TelegramBot/BotManager.cs), а также "слушатели" сообщений [`MessagesProcessor`](/TelegramBot/UpdateProcessors/MessagesProcessor.cs) и [`CallbackQueryProcessor`](/TelegramBot/UpdateProcessors/CallbackQueryProcessor.cs), получаемых от пользователся. Таким образом, реализован `Event Pattern`.

В свою очередь при получении сообщения обработчики событий передают контроль обработчику состояний каждого чата [`StateProcessor`](/TelegramBot/StateProcessor.cs), который, в зависимости от состояния отправляет файлы/запросы/сообщения пользователю и обрабатывает их.

![Telegram Class Diagram](/readme-assert/TelegramClassDiagram.png)

 ## Некоторые Functional Feature (a.k.a. фичи) решения

- Реализована _**"умная"**_ сортировка по нескольким полям. С помощью выбора различных полей в списке формируется упорядоченный список полей. Сначала объекты сортируются по первому полю: при равенстве этих полей используется сортировка по второму выбранному полю, и т.д. Для каждого поля можно выбрать порядок сортировки (по возрастанию или по убыванию).
- Реализована _**"умная"**_ фильтрация по нескольким полям. Выбираются только те записи, которые удовлетворяют каждому критерию (то есть используюется логическое И между заправшиваемыми данными)
- Реализовано **сохранение предыдущих обработок**. Это означает, что пользователь вместо загрузки файла для обработки со своего устройства, может зпросить обработку файлов, который недавно были отсортированы или отфильтрованы (а именно последние 3 обработанных файла).